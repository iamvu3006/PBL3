<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout :: layout}">
<head>
  <title>Giỏ Hàng</title>
  <link rel="stylesheet" th:href="@{/css/common.css}">
  <link rel="stylesheet" th:href="@{/css/cart.css}">
</head>

<body>
  <!-- chèn Header -->
  <div layout:fragment="siteHeader"></div>

  <main class="container">
    <h1 class="section-title">Giỏ Hàng</h1>

    <nav class="breadcrumb">
      <a th:href="@{/}">Trang Chủ</a> &gt; <span>Giỏ Hàng</span>
    </nav>

    <section>
      <!-- Khi giỏ trống -->
      <div th:if="${#lists.isEmpty(items)}" class="empty-cart">
        <p>Giỏ hàng của bạn đang trống.</p>
        <a th:href="@{ / }" class="btn btn-primary">Tiếp tục mua sắm</a>
      </div>

      <!-- Khi có sản phẩm -->
      <div th:if="${!#lists.isEmpty(items)}">
        <table class="table">
          <thead>
            <tr>
              <th>Sản phẩm</th>
              <th>Đơn giá</th>
              <th>Số lượng</th>
              <th>Thành tiền</th>
              <th>Thao tác</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="item : ${items}">
              <td th:text="${item.name}">–</td>
              <td th:text="${#numbers.formatDecimal(item.price,0,'','.',',')} + ' VND'">–</td>
              <td th:text="${item.quantity}">–</td>
              <td th:text="${#numbers.formatDecimal(item.price * item.quantity,0,'','.',',')} + ' VND'">–</td>
              <td>
                <form th:action="@{/cart/remove}" method="post">
                  <!-- CSRF token -->
                  <input type="hidden" name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                  <input type="hidden" name="productId" th:value="${item.productId}"/>
                  <button type="submit" class="btn btn-warning">Xóa</button>
                </form>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="cart-summary">
          <p>
            <strong>Tổng giá trị:</strong>
            <span th:text="${#numbers.formatDecimal(total,0,'','.',',')} + ' VND'">–</span>
          </p>
          <form th:action="@{/cart/checkout}" method="post">
            <input type="hidden" name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <button type="submit" class="btn btn-primary">Tiến Hành Thanh Toán</button>
          </form>
        </div>
      </div>
    </section>
  </main>

  <!-- chèn Footer -->
  <div layout:fragment="siteFooter"></div>
</body>
</html>
